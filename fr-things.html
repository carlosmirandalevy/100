<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les 100+ choses | 100+ choses avec l'IA | CEMI.AI</title>
    <meta name="description" content="Explorez 100+ choses que vous pouvez faire avec l'IA. Recherchez, filtrez et découvrez des façons créatives d'utiliser l'intelligence artificielle.">
    <script src="include.js"></script>
</head>
<body data-page="things">

<!-- ===== PAGE HERO ===== -->
<section class="page-hero">
    <div class="hero-orb hero-orb-1" style="width:300px;height:300px"></div>
    <div class="hero-orb hero-orb-2" style="width:250px;height:250px"></div>
    <div class="page-hero-content">
        <h1><span class="gradient-text">Les 100+ choses</span></h1>
        <p><strong>Explore, apprends et crée avec l'IA</strong></p>
        <p>l'IA, ce n'est pas faire la même chose plus vite et plus facilement &mdash; c'est faire <strong>PLUS</strong> et <strong>MIEUX</strong> qu'avant.</p>
    </div>
</section>

<!-- ===== THE 100 THINGS ===== -->
<section class="section" id="things" style="background:var(--bg-secondary)">
    <div class="container">
        <div class="search-bar reveal">
            <div class="search-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            </div>
            <input type="text" id="search-input" placeholder="Rechercher parmi les 100+ choses...">
            <button class="search-clear" id="search-clear" aria-label="Clear search">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>

        <div class="filter-bar reveal">
            <button class="filter-pill active" data-category="all">Tout (100+)</button>
            <button class="filter-pill" data-category="writing" style="--pill-color:var(--cat-writing)">Écriture</button>
            <button class="filter-pill" data-category="learning" style="--pill-color:var(--cat-learning)">Apprentissage</button>
            <button class="filter-pill" data-category="art" style="--pill-color:var(--cat-art)">Art &amp; Design</button>
            <button class="filter-pill" data-category="music" style="--pill-color:var(--cat-music)">Musique</button>
            <button class="filter-pill" data-category="video" style="--pill-color:var(--cat-video)">Vidéo</button>
            <button class="filter-pill" data-category="productivity" style="--pill-color:var(--cat-productivity)">Productivité</button>
            <button class="filter-pill" data-category="coding" style="--pill-color:var(--cat-coding)">Code</button>
            <button class="filter-pill" data-category="business" style="--pill-color:var(--cat-business)">Business</button>
            <button class="filter-pill" data-category="science" style="--pill-color:var(--cat-science)">Sciences</button>
            <button class="filter-pill" data-category="fun" style="--pill-color:var(--cat-fun)">Fun</button>
        </div>

        <div class="results-count" id="results-count">Affichage de 102 sur 107</div>
        <div id="items-container"></div>
    </div>
</section>

<!-- ===== PROGRESS TRACKER ===== -->
<div class="progress-tracker" id="progress-tracker">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path></svg>
    <span id="progress-count">0</span> sur <span id="total-count">119</span> explorés
</div>

<!-- ===== DATA: THE 100 ITEMS ===== -->
<script src="ascii-examples.js"></script>
<script src="game-examples.js"></script>
<script src="data-fr.js"></script>

<!-- ===== ITEMS APPLICATION LOGIC ===== -->
<script>
(function() {
    'use strict';

    const exploredItems = new Set();
    let currentCategory = 'all';
    let currentSearch = '';
    let lastScrollY = window.scrollY;
    let debounceTimer = null;

    const categoryColors = {
        writing:      { color: '#a70000', gradient: 'linear-gradient(135deg, #a70000, #c43030)' },
        learning:     { color: '#D9A441', gradient: 'linear-gradient(135deg, #D9A441, #E0CBA8)' },
        art:          { color: '#2F4F6F', gradient: 'linear-gradient(135deg, #2F4F6F, #4A7A9F)' },
        music:        { color: '#4B775A', gradient: 'linear-gradient(135deg, #4B775A, #6B9B72)' },
        video:        { color: '#A67F5B', gradient: 'linear-gradient(135deg, #A67F5B, #C4A882)' },
        productivity: { color: '#4B775A', gradient: 'linear-gradient(135deg, #4B775A, #6B9B72)' },
        coding:       { color: '#2F4F6F', gradient: 'linear-gradient(135deg, #2F4F6F, #4A7A9F)' },
        business:     { color: '#A67F5B', gradient: 'linear-gradient(135deg, #A67F5B, #C4A882)' },
        science:      { color: '#2F4F6F', gradient: 'linear-gradient(135deg, #2F4F6F, #4A7A9F)' },
        fun:          { color: '#a70000', gradient: 'linear-gradient(135deg, #a70000, #c43030)' }
    };

    function getCategoryGradient(cat) { return (categoryColors[cat] && categoryColors[cat].gradient) || 'linear-gradient(135deg, #a70000, #c43030)'; }

    function escapeHtml(str) {
        if (!str) return '';
        const d = document.createElement('div');
        d.appendChild(document.createTextNode(str));
        return d.innerHTML;
    }

    function renderItems(filterCat, searchTerm) {
        filterCat = filterCat || 'all';
        searchTerm = searchTerm || '';
        const container = document.getElementById('items-container');
        if (!container || typeof ITEMS === 'undefined') return;

        const filtered = ITEMS.filter(item => {
            const matchCat = filterCat === 'all' || item.category === filterCat;
            const t = searchTerm.toLowerCase();
            const matchSearch = !t || (item.title + ' ' + item.subtitle + ' ' + item.description + ' ' + item.category).toLowerCase().includes(t);
            return matchCat && matchSearch;
        }).sort((a, b) => a.id - b.id);

        document.getElementById('results-count').textContent = 'Affichage de ' + filtered.length + ' sur ' + ITEMS.length;

        if (!filtered.length) {
            container.innerHTML = '<div class="items-empty"><p>Aucun élément ne correspond à votre recherche. Essayez d\'autres mots-clés.</p></div>';
            return;
        }

        container.innerHTML = filtered.map(item => {
            const grad = getCategoryGradient(item.category);
            const explored = exploredItems.has(item.id) ? ' explored' : '';
            var examples = item.examples || (window.ASCII_EXAMPLES && ASCII_EXAMPLES[item.id]) || (window.GAME_EXAMPLES && GAME_EXAMPLES[item.id]) || null;
            return `<div class="item-card${explored}" data-id="${item.id}">
                <div class="item-header" data-item-id="${item.id}">
                    <div class="item-number" style="background:${grad}">${item.id}</div>
                    <div class="item-header-text">
                        <h3 class="item-title">${escapeHtml(item.title)}</h3>
                        <p class="item-subtitle">${escapeHtml(item.subtitle)}</p>
                    </div>
                    <button class="item-share-btn" data-share-id="${item.id}" data-share-title="${escapeHtml(item.title)}" data-share-subtitle="${escapeHtml(item.subtitle)}" data-share-desc="${escapeHtml(item.description)}" aria-label="Share" onclick="event.stopPropagation()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                    </button>
                    <div class="item-chevron" id="chevron-${item.id}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </div>
                </div>
                <div class="item-body" id="body-${item.id}">
                    <p class="item-description">${escapeHtml(item.description)}</p>
                    <div class="item-steps">
                        <h4><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg> Étape par étape</h4>
                        <ol>${item.steps.map(s => '<li>' + escapeHtml(s) + '</li>').join('')}</ol>
                    </div>
                    <div class="prompt-block" data-prompt="${escapeHtml(item.prompt)}">
                        <div class="prompt-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg> Prompt prêt à utiliser</div>
                        <pre><code>${escapeHtml(item.prompt)}</code></pre>
                        <button class="copy-btn" aria-label="Copy"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path></svg><span>Copier</span></button>
                    </div>
                    <div class="tip-box"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> <strong>Personnalisez-le :</strong>&nbsp;${escapeHtml(item.promptTip)}</div>
                    ${item.prompt2 ? '<div class="prompt-block prompt-block-alt" data-prompt="' + escapeHtml(item.prompt2) + '"><div class="prompt-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg> ' + escapeHtml(item.prompt2Label || 'Example Prompt with Sample Data') + '</div><pre><code>' + escapeHtml(item.prompt2) + '</code></pre><div class="prompt2-actions"><button class="copy-btn" aria-label="Copy"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path></svg><span>Copy</span></button>' + (item.prompt2Demos ? item.prompt2Demos.map(function(d){ return '<button class="preview-btn" data-preview-src="' + escapeHtml(d.src) + '" data-preview-title="' + escapeHtml(d.label + ' — ' + (item.prompt2Label || item.title)) + '"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg><span>' + escapeHtml(d.label) + '</span></button>';}).join('') : '') + '</div></div>' : ''}
                    ${item.prompt3 ? '<div class="prompt-block prompt-block-alt" data-prompt="' + escapeHtml(item.prompt3) + '"><div class="prompt-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg> ' + escapeHtml(item.prompt3Label || 'Try It: Editable Dashboard') + '</div><pre><code>' + escapeHtml(item.prompt3) + '</code></pre><div class="prompt2-actions"><button class="copy-btn" aria-label="Copy"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"></path></svg><span>Copy</span></button>' + (item.prompt3Demos ? item.prompt3Demos.map(function(d){ return '<button class="preview-btn" data-preview-src="' + escapeHtml(d.src) + '" data-preview-title="' + escapeHtml(d.label + ' \u2014 ' + (item.prompt3Label || item.title)) + '"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg><span>' + escapeHtml(d.label) + '</span></button>';}).join('') : '') + '</div></div>' : ''}
                    ${examples ? '<div class="examples-section"><div class="examples-heading"><svg width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg> Exemples</div>' + (examples[0] && examples[0].type==='game' && window.GAME_EXAMPLES_INTRO ? '<p class="examples-intro">' + escapeHtml(GAME_EXAMPLES_INTRO[document.documentElement.lang] || GAME_EXAMPLES_INTRO.en) + '</p>' : '') + '<div class="examples-grid">' + examples.map((ex,ei) => '<div class="example-card"><div class="example-card-preview">' + (ex.type==='static' ? '<div class="example-art">' + escapeHtml(ex.art) + '</div>' : ex.type==='game' ? '<div class="example-game-placeholder">' + (ex.heroImg ? '<img src="' + ex.heroImg + '" alt="' + escapeHtml(ex.title) + '">' : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"></rect><line x1="6" y1="12" x2="10" y2="12"></line><line x1="8" y1="10" x2="8" y2="14"></line><circle cx="17" cy="11" r="1"></circle><circle cx="15" cy="13" r="1"></circle></svg>') + '</div>' : '<div class="example-anim-placeholder"><svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>' + escapeHtml(ex.title) + '</div>') + '</div><div class="example-card-footer"><span class="example-card-title">' + escapeHtml(ex.title) + '</span>' + (ex.type==='game' ? '<div class="example-game-btns"><button class="example-play-btn" data-game-src="' + ex.gameSrc + '" data-game-title="' + escapeHtml(ex.title) + '">Jouer</button><button class="example-prompt-btn" data-prompt-src="' + ex.promptSrc + '" data-game-title="' + escapeHtml(ex.title) + '">Prompt</button><a class="example-dl-btn" href="' + ex.gameSrc + '" download>T\u00e9l\u00e9charger</a></div>' : '<button class="example-btn" data-item-idx="' + item.id + '" data-ex-idx="' + ei + '">' + (ex.type==='static' ? 'Voir' : 'Jouer') + '</button>') + '</div></div>').join('') + '</div></div>' : ''}
                    <div class="tools-list">
                        <span class="tools-label"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"></path></svg> Outils :</span>
                        ${item.tools.map(t => '<span class="tool-pill">' + escapeHtml(t) + '</span>').join('')}
                    </div>
                    ${item.links ? '<div class="links-list">' + item.links.map(l => '<a href="' + escapeHtml(l.url) + '" target="_blank" class="resource-link"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg> ' + escapeHtml(l.name) + '</a>').join('') + '</div>' : ''}
                    <a href="https://cemi.ai" target="_blank" class="contact-link"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"></path></svg> Besoin d'aide ? Contactez-nous à cemi.AI</a>
                </div>
            </div>`;
        }).join('');

        attachListeners();
    }


    function attachListeners() {
        document.querySelectorAll('.item-header').forEach(h => {
            h.addEventListener('click', () => toggleItem(parseInt(h.dataset.itemId)));
        });
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation();
                const block = btn.closest('.prompt-block');
                copyPrompt(btn, block ? block.dataset.prompt : '');
            });
        });
        if (window.shareInit) shareInit();
        document.querySelectorAll('.preview-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation();
                var src = btn.dataset.previewSrc;
                if (src.startsWith('http')) {
                    window.open(src, 'preview', 'width=1200,height=800,menubar=no,toolbar=no,location=no,status=no');
                } else {
                    openGameModal(src, btn.dataset.previewTitle, 'game');
                }
            });
        });
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation();
                var itemId = parseInt(btn.dataset.itemIdx);
                var exIdx = parseInt(btn.dataset.exIdx);
                var item = ITEMS.find(i => i.id === itemId);
                var exs = item && (item.examples || (window.ASCII_EXAMPLES && ASCII_EXAMPLES[itemId]));
                if (exs && exs[exIdx]) openAsciiModal(exs[exIdx]);
            });
        });
        document.querySelectorAll('.example-play-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation();
                openGameModal(btn.dataset.gameSrc, btn.dataset.gameTitle, 'game');
            });
        });
        document.querySelectorAll('.example-prompt-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                e.stopPropagation();
                openGameModal(btn.dataset.promptSrc, btn.dataset.gameTitle, 'prompt');
            });
        });
    }

    var asciiModalEl = null;
    function openAsciiModal(ex) {
        if (!asciiModalEl) {
            asciiModalEl = document.createElement('div');
            asciiModalEl.className = 'ascii-modal-overlay';
            asciiModalEl.innerHTML = '<div class="ascii-modal"><div class="ascii-modal-header"><span class="ascii-modal-title"></span><button class="ascii-modal-close" aria-label="Close"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div><div class="ascii-modal-body"><div class="ascii-modal-content"></div><div class="ascii-modal-prompt"><div class="ascii-modal-prompt-label">Prompt utilisé</div><div class="ascii-modal-prompt-text"></div></div></div></div>';
            document.body.appendChild(asciiModalEl);
            asciiModalEl.querySelector('.ascii-modal-close').addEventListener('click', closeAsciiModal);
            asciiModalEl.addEventListener('click', function(e) { if (e.target === asciiModalEl) closeAsciiModal(); });
        }
        asciiModalEl.querySelector('.ascii-modal-title').textContent = ex.title;
        asciiModalEl.querySelector('.ascii-modal-prompt-text').textContent = ex.prompt;
        var content = asciiModalEl.querySelector('.ascii-modal-content');
        if (ex.type === 'static' && !ex.html) {
            content.innerHTML = '<pre class="ascii-modal-art">' + escapeHtml(ex.art) + '</pre>';
        } else {
            content.innerHTML = '';
            var iframe = document.createElement('iframe');
            iframe.className = 'ascii-modal-iframe';
            iframe.setAttribute('sandbox', 'allow-scripts');
            iframe.srcdoc = ex.html;
            content.appendChild(iframe);
        }
        requestAnimationFrame(function() { asciiModalEl.classList.add('open'); });
        document.addEventListener('keydown', asciiModalEsc);
    }
    function closeAsciiModal() {
        if (!asciiModalEl) return;
        asciiModalEl.classList.remove('open');
        var iframe = asciiModalEl.querySelector('iframe');
        if (iframe) iframe.removeAttribute('srcdoc');
        document.removeEventListener('keydown', asciiModalEsc);
    }
    function asciiModalEsc(e) { if (e.key === 'Escape') closeAsciiModal(); }

    var gameModalEl = null;
    function openGameModal(src, title, mode) {
        var lang = document.documentElement.lang || 'en';
        var copyLabels = {en:'Copy',fr:'Copier',es:'Copiar',pt:'Copiar',de:'Kopieren',it:'Copia',ja:'\u30b3\u30d4\u30fc',zh:'\u590d\u5236'};
        var copiedLabels = {en:'Copied!',fr:'Copi\u00e9 !',es:'\u00a1Copiado!',pt:'Copiado!',de:'Kopiert!',it:'Copiato!',ja:'\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f',zh:'\u5df2\u590d\u5236'};
        var copyLabel = copyLabels[lang] || copyLabels.en;
        var copiedLabel = copiedLabels[lang] || copiedLabels.en;
        if (!gameModalEl) {
            gameModalEl = document.createElement('div');
            gameModalEl.className = 'game-modal-overlay';
            gameModalEl.innerHTML = '<div class="game-modal"><div class="game-modal-header"><span class="game-modal-title"></span><div class="game-modal-actions"><button class="game-modal-copy-btn" style="display:none"></button><button class="game-modal-close" aria-label="Close"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div></div><div class="game-modal-body"><iframe class="game-modal-iframe" sandbox="allow-scripts allow-same-origin"></iframe></div></div>';
            document.body.appendChild(gameModalEl);
            gameModalEl.querySelector('.game-modal-close').addEventListener('click', closeGameModal);
            gameModalEl.addEventListener('click', function(e) { if (e.target === gameModalEl) closeGameModal(); });
            gameModalEl.querySelector('.game-modal-copy-btn').addEventListener('click', function() {
                var iframe = gameModalEl.querySelector('.game-modal-iframe');
                var btn = this;
                try {
                    var doc = iframe.contentDocument || iframe.contentWindow.document;
                    var promptEl = doc.querySelector('.prompt');
                    var text = promptEl ? promptEl.textContent : '';
                    if (text) {
                        navigator.clipboard.writeText(text).then(function() {
                            btn.textContent = copiedLabel;
                            btn.classList.add('copied');
                            setTimeout(function() { btn.textContent = copyLabel; btn.classList.remove('copied'); }, 2000);
                        }).catch(function() {
                            var ta = document.createElement('textarea');
                            ta.value = text; ta.style.cssText = 'position:fixed;opacity:0';
                            document.body.appendChild(ta); ta.select();
                            try { document.execCommand('copy'); btn.textContent = copiedLabel; btn.classList.add('copied'); setTimeout(function() { btn.textContent = copyLabel; btn.classList.remove('copied'); }, 2000); } catch(e) {}
                            document.body.removeChild(ta);
                        });
                    }
                } catch(e) {}
            });
        }
        gameModalEl.querySelector('.game-modal-title').textContent = title;
        var iframe = gameModalEl.querySelector('.game-modal-iframe');
        iframe.src = src;
        iframe.onload = function() { setTimeout(function() { try { iframe.contentWindow.focus(); } catch(e) {} }, 100); };
        var copyBtn = gameModalEl.querySelector('.game-modal-copy-btn');
        if (mode === 'prompt') {
            copyBtn.textContent = copyLabel;
            copyBtn.style.display = '';
            copyBtn.classList.remove('copied');
        } else {
            copyBtn.style.display = 'none';
        }
        requestAnimationFrame(function() { gameModalEl.classList.add('open'); });
        document.addEventListener('keydown', gameModalEsc);
    }
    function closeGameModal() {
        if (!gameModalEl) return;
        gameModalEl.classList.remove('open');
        var iframe = gameModalEl.querySelector('.game-modal-iframe');
        if (iframe) iframe.removeAttribute('src');
        document.removeEventListener('keydown', gameModalEsc);
    }
    function gameModalEsc(e) { if (e.key === 'Escape') closeGameModal(); }

    function toggleItem(id) {
        const body = document.getElementById('body-' + id);
        const chevron = document.getElementById('chevron-' + id);
        if (!body) return;
        body.classList.toggle('open');
        if (chevron) chevron.classList.toggle('rotated');
        if (body.classList.contains('open') && !exploredItems.has(id)) {
            exploredItems.add(id);
            updateProgress();
            const card = body.closest('.item-card');
            if (card) card.classList.add('explored');
        }
    }
    window.toggleItem = toggleItem;

    function copyPrompt(btn, text) {
        if (!text) return;
        navigator.clipboard.writeText(text).then(() => showCopied(btn)).catch(() => {
            const ta = document.createElement('textarea');
            ta.value = text; ta.style.cssText = 'position:fixed;opacity:0';
            document.body.appendChild(ta); ta.select();
            try { document.execCommand('copy'); showCopied(btn); } catch(e) {}
            document.body.removeChild(ta);
        });
    }

    function showCopied(btn) {
        const s = btn.querySelector('span');
        if (s) s.textContent = 'Copié !';
        btn.classList.add('copied');
        setTimeout(() => { if (s) s.textContent = 'Copier'; btn.classList.remove('copied'); }, 2000);
    }

    function updateProgress() {
        const el = document.getElementById('progress-count');
        if (el) el.textContent = exploredItems.size;
        const t = document.getElementById('progress-tracker');
        if (t && exploredItems.size > 0) t.classList.add('visible');
    }

    // Scroll animations
    if ('IntersectionObserver' in window) {
        const obs = new IntersectionObserver(entries => entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('active'); obs.unobserve(e.target); } }), { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
        document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    } else {
        document.querySelectorAll('.reveal').forEach(el => el.classList.add('active'));
    }

    // Filters
    document.querySelectorAll('.filter-pill').forEach(pill => {
        pill.addEventListener('click', () => {
            document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
            pill.classList.add('active');
            currentCategory = pill.dataset.category;
            renderItems(currentCategory, currentSearch);
        });
    });

    // Search
    const searchInput = document.getElementById('search-input');
    const searchClear = document.getElementById('search-clear');
    if (searchInput) searchInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        const v = this.value;
        debounceTimer = setTimeout(() => { currentSearch = v; renderItems(currentCategory, currentSearch); }, 250);
        if (searchClear) searchClear.style.display = v.length ? 'flex' : 'none';
    });
    if (searchClear) searchClear.addEventListener('click', () => { searchInput.value = ''; currentSearch = ''; renderItems(currentCategory, currentSearch); searchClear.style.display = 'none'; searchInput.focus(); });

    // Scroll to top
    const scrollBtn = document.getElementById('scroll-top-btn');
    window.addEventListener('scroll', () => { if (scrollBtn) scrollBtn.classList.toggle('visible', window.scrollY > 600); }, { passive: true });
    if (scrollBtn) scrollBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

    // Smooth scroll all anchors
    document.querySelectorAll('a[href^="#"]').forEach(a => a.addEventListener('click', function(e) { const h = this.getAttribute('href'); if (h && h.length > 1) { const t = document.querySelector(h); if (t) { e.preventDefault(); t.scrollIntoView({ behavior: 'smooth' }); } } }));

    // Init — render items, then override nav search for in-page filtering
    function init() {
        // Read search query from URL (cross-page search)
        var urlParams = new URLSearchParams(window.location.search);
        var urlQuery = urlParams.get('q');
        if (urlQuery && searchInput) {
            searchInput.value = urlQuery;
            currentSearch = urlQuery;
            if (searchClear) searchClear.style.display = 'flex';
        }

        renderItems(currentCategory, currentSearch);
        // Deep link: open specific item by ?id=N
        var urlId = urlParams.get('id');
        if (urlId) {
            var nid = parseInt(urlId);
            if (nid) {
                setTimeout(function() {
                    var card = document.querySelector('.item-card[data-id="' + nid + '"]');
                    if (card) {
                        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        toggleItem(nid);
                    }
                }, 300);
            }
        }


        // Override search modal to filter in-page on this page
        var modalInput = document.getElementById('search-modal-input');
        var modalOverlay = document.getElementById('search-modal-overlay');
        if (modalInput) {
            modalInput.addEventListener('input', function() {
                searchInput.value = this.value;
                currentSearch = this.value;
                renderItems(currentCategory, currentSearch);
                if (searchClear) searchClear.style.display = this.value.length ? 'flex' : 'none';
            });
            modalInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && this.value.trim()) {
                    e.preventDefault();
                    if (modalOverlay) modalOverlay.classList.remove('open');
                    searchInput.value = this.value;
                    currentSearch = this.value;
                    renderItems(currentCategory, currentSearch);
                    if (searchClear) searchClear.style.display = 'flex';
                }
            });
        }
    }

    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
    else init();
})();
</script>
<script src="share.js"></script>

</body>
</html>
